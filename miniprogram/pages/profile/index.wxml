<view
  class="lc-root {{theme === 'dark' ? 'lc-theme-dark' : ''}}"
  style="--lc-status-bar: {{statusBarRpx}}rpx; --lc-safe-bottom: {{safeBottomRpx}}rpx;"
>
  <view class="lc-header">
    <view class="lc-header-inner">
      <text class="lc-header-title">LearnCards</text>
    </view>
  </view>

  <view class="lc-main">
    <view class="lc-container">
      <view class="title-block">
        <view class="lc-h1">Settings</view>
      </view>

      <view wx:if="{{isLoading}}" class="lc-inline-loading" style="padding: 24rpx 0;">
        <view class="lc-mini-spinner" />
        <text class="lc-p">Loading...</text>
      </view>

      <!-- User Stats Card -->
      <view class="stats-hero">
        <view class="hero-top">
          <view class="hero-cell">
            <view class="hero-label">Total Points</view>
            <view class="hero-value">{{pointsText}}</view>
          </view>
          <view class="hero-cell right">
            <view class="hero-label">Global Rank</view>
            <view class="hero-value">#{{globalRank}}</view>
          </view>
        </view>

        <view class="hero-bottom">
          <view class="mini">
            <view class="mini-label">Streak</view>
            <view class="mini-value">{{streak}} days</view>
          </view>
          <view class="mini">
            <view class="mini-label">Total Cards</view>
            <view class="mini-value">{{cardCount}}</view>
          </view>
          <view class="mini">
            <view class="mini-label">Today</view>
            <view class="mini-value">{{cardsStudiedToday}}/{{dailyGoal}}</view>
          </view>
        </view>
      </view>

      <!-- Settings Groups -->
      <view class="group">
        <view class="group-title">Account</view>
        <view class="group-card">
          <view class="row" bind:tap="onOpenEditUsername" hover-class="lc-hover-bg">
            <t-icon name="edit" size="36rpx" color="var(--lc-text-muted)" />
            <text class="row-label">Username</text>
            <text class="row-value">{{username || 'Set username'}}</text>
            <t-icon name="chevron-right" size="36rpx" color="var(--lc-text-subtle)" />
          </view>
          <view class="row" bind:tap="onRequestUserProfile" hover-class="lc-hover-bg">
            <t-icon name="user" size="36rpx" color="var(--lc-text-muted)" />
            <text class="row-label">Profile</text>
            <text class="row-value">Student</text>
            <t-icon name="chevron-right" size="36rpx" color="var(--lc-text-subtle)" />
          </view>
          <view class="row" bind:tap="onToggleNotifications" hover-class="lc-hover-bg">
            <t-icon name="notification" size="36rpx" color="var(--lc-text-muted)" />
            <text class="row-label">Notifications</text>
            <text class="row-value">{{notifications ? 'Enabled' : 'Disabled'}}</text>
            <t-icon name="chevron-right" size="36rpx" color="var(--lc-text-subtle)" />
          </view>
        </view>
      </view>

      <view class="group">
        <view class="group-title">Appearance</view>
        <view class="group-card">
          <view class="row" bind:tap="onOpenTheme" hover-class="lc-hover-bg">
            <t-icon name="star" size="36rpx" color="var(--lc-text-muted)" />
            <text class="row-label">Theme</text>
            <text class="row-value">
              <block wx:if="{{themeMode === 'system'}}">System</block>
              <block wx:elif="{{themeMode === 'dark'}}">Dark</block>
              <block wx:else>Light</block>
            </text>
            <t-icon name="chevron-right" size="36rpx" color="var(--lc-text-subtle)" />
          </view>
        </view>
      </view>

      <view class="group">
        <view class="group-title">Data & Privacy</view>
        <view class="group-card">
          <view class="row" bind:tap="onPrivacyPolicy" hover-class="lc-hover-bg">
            <t-icon name="lock-on" size="36rpx" color="var(--lc-text-muted)" />
            <text class="row-label">Privacy Policy</text>
            <t-icon name="chevron-right" size="36rpx" color="var(--lc-text-subtle)" />
          </view>
          <view class="row" bind:tap="onExportData" hover-class="lc-hover-bg">
            <t-icon name="download" size="36rpx" color="var(--lc-text-muted)" />
            <text class="row-label">Export Data</text>
            <t-icon name="chevron-right" size="36rpx" color="var(--lc-text-subtle)" />
          </view>
        </view>
      </view>

      <!-- Disclaimer -->
      <view class="disclaimer">
        <view class="disclaimer-title">⚠️ Privacy Notice</view>
        <view class="disclaimer-text">
          This app is designed for educational purposes. Do not store personally identifiable information (PII) or
          sensitive data in your study cards.
        </view>
      </view>

      <!-- Sign Out -->
      <button class="signout" bind:tap="onSignOut" hover-class="lc-hover-danger-bg">
        <t-icon name="logout" size="36rpx" color="var(--lc-danger)" />
        <text style="margin-left: 12rpx;">Sign Out</text>
      </button>

      <view class="version">Version {{version}}</view>
    </view>
  </view>

  <!-- Username Modal -->
  <view wx:if="{{isEditingUsername}}" class="lc-modal-overlay" catch:tap="onCancelEditUsername">
    <view class="lc-modal" catch:tap="noop">
      <view class="lc-modal-header">
        <text class="lc-modal-title">Set Username</text>
      </view>
      <view class="lc-modal-body">
        <input
          class="lc-input"
          placeholder="Your name shown in Rank"
          placeholder-class="home-placeholder"
          value="{{tempUsername}}"
          bindinput="onTempUsernameInput"
        />
        <view class="lc-p" style="margin-top: 16rpx;">Max 20 characters.</view>
      </view>
      <view class="lc-modal-footer">
        <button class="lc-btn lc-btn-outline" bind:tap="onCancelEditUsername" hover-class="lc-hover-bg">Cancel</button>
        <button class="lc-btn lc-btn-primary" style="margin-left: 16rpx;" bind:tap="onSaveUsername" hover-class="lc-hover-primary">Save</button>
      </view>
    </view>
  </view>

  <!-- Theme Modal -->
  <view wx:if="{{isEditingTheme}}" class="lc-modal-overlay" catch:tap="onCloseTheme">
    <view class="lc-modal" catch:tap="noop">
      <view class="lc-modal-header">
        <text class="lc-modal-title">Theme</text>
      </view>
      <view class="lc-modal-body">
        <view class="lc-p" style="margin-bottom: 16rpx;">Choose appearance:</view>
        <view class="preset-grid" style="grid-template-columns: repeat(3, 1fr);">
          <view class="preset-item {{themeMode === 'system' ? 'is-active' : ''}}" data-mode="system" catch:tap="onPickThemeMode">
            <view class="preset-num">System</view>
            <view class="preset-sub">Follow WeChat</view>
          </view>
          <view class="preset-item {{themeMode === 'light' ? 'is-active' : ''}}" data-mode="light" catch:tap="onPickThemeMode">
            <view class="preset-num">Light</view>
            <view class="preset-sub">Always light</view>
          </view>
          <view class="preset-item {{themeMode === 'dark' ? 'is-active' : ''}}" data-mode="dark" catch:tap="onPickThemeMode">
            <view class="preset-num">Dark</view>
            <view class="preset-sub">Always dark</view>
          </view>
        </view>
      </view>
      <view class="lc-modal-footer">
        <button class="lc-btn lc-btn-outline" bind:tap="onCloseTheme" hover-class="lc-hover-bg">Close</button>
      </view>
    </view>
  </view>
</view>
