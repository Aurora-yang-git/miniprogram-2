<view class="page-container" style="background: #E8ECF0;">
  <view class="review-header" style="padding-top: {{statusBarRpx + 24}}rpx;">
    <view class="header-close" catch:tap="onExitReview">
      <t-icon name="close" size="40rpx" />
    </view>
    <view class="progress-track">
      <view
        class="progress-bar"
        style="width: {{ totalCards ? (currentIndex + 1) / totalCards * 100 : 0 }}%"
      ></view>
    </view>
    <view class="progress-text">{{currentIndex + 1}} / {{totalCards}}</view>
  </view>

  <view wx:if="{{currentCard}}" class="card-stage" bind:tap="onFlipCard">
    <view class="flip-wrapper {{isFlipped ? 'flipped' : ''}}">
      
      <!-- æ­£é¢ï¼šé—®é¢˜ -->
      <view class="card-face face-front">
        <view class="card-type-badge">é—® Question</view>
        <view class="card-tag"># {{(currentCard.tags && currentCard.tags[0]) || 'çŸ¥è¯†ç‚¹'}}</view>
        <view class="content-center">
          <view class="text-h1">{{currentCard.question}}</view>
        </view>
        <view class="tap-hint">ç‚¹å‡»ç¿»è½¬ ðŸ‘†</view>
      </view>

      <!-- åé¢ï¼šç­”æ¡ˆ -->
      <view class="card-face face-back">
        <view class="card-type-badge" style="background: var(--c-success-light); color: var(--c-success-dark);">ç­” Answer</view>
        <scroll-view scroll-y class="answer-content">
          <view class="notebook-lines"></view>
          
          <view style="position: relative; z-index: 2;">
             <block wx:for="{{currentCard.answerSections}}" wx:key="index">
               <view class="ans-item">
                 <view class="ans-label">{{item.type || 'CONTENT'}}</view>
                 
                 <!-- æ–‡æœ¬/å®šä¹‰ -->
                 <view wx:if="{{item.type === 'text' || item.type === 'definition'}}" class="ans-text text-body {{item.type}}">
                   {{item.content}}
                 </view>
                 
                 <!-- å…¬å¼ -->
                 <view wx:elif="{{item.type === 'formula'}}" class="ans-formula">
                   {{item.latex || item.content}}
                 </view>
                 
                 <!-- ä»£ç  -->
                 <view wx:elif="{{item.type === 'code'}}" class="ans-code">
                   <text class="code-text">{{item.code || item.content}}</text>
                 </view>
                 
                 <!-- å›¾ç‰‡ -->
                 <view wx:elif="{{item.type === 'image'}}" class="ans-image-wrapper">
                   <image class="ans-image" src="{{item.imageUrl}}" mode="widthFix" />
                 </view>

                 <!-- é»˜è®¤æ˜¾ç¤º -->
                 <view wx:else class="ans-text text-body">
                   {{item.content || ''}}
                 </view>
               </view>
             </block>
          </view>
        </scroll-view>
      </view>

    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="action-bar row-between {{isFlipped ? 'active' : ''}}">
    <view class="btn-game btn-forget" catch:tap="onResult" data-type="forget">
      <t-icon name="close" size="48rpx" /> å¿˜è®°
    </view>
    <view class="btn-game btn-remember" catch:tap="onResult" data-type="remember">
      <t-icon name="check" size="48rpx" /> è®°å¾—
    </view>
  </view>

  <view wx:if="{{!currentCard}}" class="empty">
    <t-empty icon="check-circle-filled" description="æš‚æ— å¤ä¹ ä»»åŠ¡" />
  </view>
</view>
