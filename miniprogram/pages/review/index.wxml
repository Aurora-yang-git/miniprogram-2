      <view
  class="lc-root {{theme === 'dark' ? 'lc-theme-dark' : ''}}"
  style="--lc-status-bar: {{statusBarRpx}}rpx; --lc-safe-bottom: {{safeBottomRpx}}rpx; --lc-tabbar-h: 0rpx;"
>
  <view class="lc-header">
    <view class="lc-header-inner">
      <text class="lc-header-title">LearnCards</text>
    </view>
  </view>

  <view class="lc-main">
    <view class="lc-container">
      <!-- Summary -->
      <view wx:if="{{showSummary}}" class="summary">
        <view class="summary-header">
          <view class="summary-title">Study Session Complete</view>
          <view class="summary-sub">{{deckTitle}}</view>
      </view>

        <view class="summary-stats">
          <view class="stat-box good">
            <view class="stat-num">{{understoodCount}}</view>
            <view class="stat-name">Understood</view>
          </view>
          <view class="stat-box bad">
            <view class="stat-num">{{notUnderstoodCount}}</view>
            <view class="stat-name">Need Review</view>
          </view>
                 </view>
                 
        <view wx:if="{{notUnderstoodCards.length}}" class="lc-card review-list">
          <view class="review-title">Cards to Review ({{notUnderstoodCount}})</view>
          <view class="review-items">
            <block wx:for="{{notUnderstoodCards}}" wx:key="cardId">
              <view class="review-item">
                <rich-text class="review-q" nodes="{{item.questionRich || ('Q: ' + item.question)}}" />
                <rich-text class="review-a" nodes="{{item.answerRich || ('A: ' + item.answer)}}" />
              </view>
            </block>
          </view>
                 </view>
                 
        <view wx:else class="done-card">
          Perfect! You understood all cards!
                 </view>
                 
        <view class="summary-actions">
          <button class="lc-btn lc-btn-outline action-btn" bind:tap="onRestart">
            <t-icon name="refresh" size="36rpx" color="var(--lc-primary)" />
            <text style="margin-left: 12rpx;">Restart</text>
          </button>
          <button class="lc-btn lc-btn-primary action-btn" bind:tap="onGoHome">
            <t-icon name="home" size="36rpx" color="#fff" />
            <text style="margin-left: 12rpx;">Back to Home</text>
          </button>
        </view>
                 </view>

      <!-- Loading -->
      <view wx:elif="{{isLoadingQueue}}" class="lc-card empty">
        <view class="lc-inline-loading" style="padding: 48rpx 0;">
          <view class="lc-mini-spinner" />
          <text class="lc-p">Loading review session...</text>
                 </view>
               </view>

      <!-- Main Study -->
      <view wx:elif="{{currentCard}}" class="study">
        <view class="study-header">
          <view>
            <view class="study-title">{{deckTitle}}{{round === 'relearn' ? ' (Relearn)' : ''}}</view>
            <view class="study-sub">Card {{currentIndex + 1}} / {{totalCards}}</view>
          </view>
          <button class="lc-icon-btn" bind:tap="onExitReview">
            <t-icon name="close" size="40rpx" color="var(--lc-text-muted)" />
          </button>
      </view>

        <view class="lc-progress-track" style="margin-top: 24rpx;">
          <view
            class="lc-progress-bar"
            style="width: {{ totalCards ? (currentIndex + 1) / totalCards * 100 : 0 }}%;"
          />
    </view>

        <!-- Study Card -->
        <view class="card-stage" bind:tap="onFlipCard">
          <view class="flip-wrapper {{isFlipped ? 'flipped' : ''}}">
            <view class="card-face face-front">
              <view wx:if="{{currentCard.topicBadge}}" class="topic-badge">{{currentCard.topicBadge}}</view>
              <view class="card-kicker">Question</view>
              <rich-text class="card-text" nodes="{{currentCard.questionRich || currentCard.question}}" />
              <view wx:if="{{currentCard.hint}}" class="hint-pill" catch:tap="onToggleHint">
                {{showHint ? '收起提示' : '提示'}}
              </view>
              <view wx:if="{{currentCard.hint && showHint}}" class="hint-box" catch:tap="onStopPropagation">
                <rich-text class="hint-text" nodes="{{currentCard.hintRich || currentCard.hint}}" />
              </view>
              <view class="card-hint">Tap to reveal answer</view>
  </view>

            <view class="card-face face-back">
              <view wx:if="{{currentCard.topicBadge}}" class="topic-badge topic-badge-back">{{currentCard.topicBadge}}</view>
              <view class="card-kicker back-kicker">Answer</view>
              <scroll-view scroll-y class="answer-scroll">
                <view class="answer-body">
                  <rich-text class="answer-text" nodes="{{currentCard.answerRich || currentCard.answer}}" />
                </view>
              </scroll-view>
    </view>
    </view>
  </view>

        <!-- Action Buttons -->
        <view wx:if="{{isFlipped}}" class="action-row">
          <button class="lc-btn lc-btn-danger-outline action-btn" catch:tap="onResult" data-type="forget">
            <t-icon name="close" size="36rpx" color="var(--lc-danger)" />
            <text style="margin-left: 12rpx;">Not Understand</text>
          </button>
          <button class="lc-btn lc-btn-primary action-btn" catch:tap="onResult" data-type="remember">
            <t-icon name="check" size="36rpx" color="#fff" />
            <text style="margin-left: 12rpx;">Understand</text>
          </button>
        </view>

        <button wx:else class="lc-btn lc-btn-primary full-btn" bind:tap="onShowAnswer">
          <t-icon name="refresh" size="36rpx" color="#fff" />
          <text style="margin-left: 12rpx;">Show Answer</text>
        </button>
      </view>

      <!-- Empty -->
      <view wx:else class="lc-card empty">
        <view class="lc-p" style="text-align:center;">
          No cards found for this session.
        </view>
        <button class="lc-btn lc-btn-primary full-btn" bind:tap="onGoHome">
          Back to Home
        </button>
      </view>
    </view>
  </view>
</view>
