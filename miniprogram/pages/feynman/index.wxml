<view
  class="lc-root {{theme === 'dark' ? 'lc-theme-dark' : ''}}"
  style="--lc-status-bar: {{statusBarRpx}}rpx; --lc-safe-bottom: {{safeBottomRpx}}rpx; --lc-tabbar-h: 0rpx;"
>
  <view class="lc-header">
    <view class="lc-header-inner">
      <view class="feynman-header-left">
        <button class="lc-icon-btn" bind:tap="onBackOrExit" aria-label="Back">
          <t-icon name="chevron-left" size="40rpx" color="var(--lc-text-muted)" />
        </button>
        <text class="lc-header-title">LearnCards</text>
      </view>
      <button class="lc-icon-btn" bind:tap="onToggleTheme">
        <text style="font-size: 34rpx; color: var(--lc-text-muted);">{{theme === 'dark' ? '☀' : '☾'}}</text>
      </button>
    </view>
  </view>

  <view class="lc-main">
    <view class="lc-container">
      <view class="title-block">
        <view class="lc-h1">Feynman Learning Mode</view>
        <view class="lc-p">Explain concepts in your own words to identify knowledge gaps</view>
      </view>

      <!-- Step Indicator -->
      <view class="step-row">
        <block wx:for="{{stepLabels}}" wx:key="*this">
          <view class="step-item">
            <view class="step-line {{index <= currentStepIndex ? 'is-active' : ''}}" />
            <view class="step-dot {{index <= currentStepIndex ? 'is-active' : ''}}">
              {{index + 1}}
            </view>
          </view>
        </block>
      </view>

      <!-- Upload -->
      <view wx:if="{{step === 'upload'}}" class="section">
        <view class="upload-box">
          <t-icon name="upload" size="96rpx" color="var(--lc-text-subtle)" />
          <view class="upload-title">Upload reference material</view>
          <view class="upload-sub">PDF, images, or text files</view>
        </view>

        <button class="lc-btn lc-btn-primary full-btn" disabled="{{isLoading}}" bind:tap="onContinue">
          <block wx:if="{{isLoading}}">
            <view class="mini-spinner" />
            <text style="margin-left: 12rpx;">Processing...</text>
          </block>
          <block wx:else>Continue</block>
        </button>
      </view>

      <!-- Explain -->
      <view wx:elif="{{step === 'explain'}}" class="section">
        <view class="lc-card">
          <view class="card-title">Uploaded Material</view>
          <view class="lc-p">"Quantum Mechanics: Wave-Particle Duality"</view>
        </view>

        <view class="lc-card" style="margin-top: 24rpx;">
          <view class="field-label">Explain this concept in your own words</view>
          <textarea
            class="lc-input textarea"
            placeholder="Type your explanation here... Imagine you're teaching this to a friend."
            placeholder-class="home-placeholder"
            value="{{explanation}}"
            bindinput="onExplanationInput"
          />
        </view>

        <button class="lc-btn lc-btn-primary full-btn" disabled="{{isLoading || !explanation}}" bind:tap="onGetFeedback">
          <block wx:if="{{isLoading}}">
            <view class="mini-spinner" />
            <text style="margin-left: 12rpx;">Analyzing...</text>
          </block>
          <block wx:else>
            <t-icon name="star" size="36rpx" color="#fff" />
            <text style="margin-left: 12rpx;">Get AI Feedback</text>
          </block>
        </button>
      </view>

      <!-- Feedback -->
      <view wx:elif="{{step === 'feedback'}}" class="section">
        <view class="hint-card good">
          <view class="hint-title">
            <t-icon name="star" size="32rpx" color="var(--lc-success)" />
            <text>Concepts You Know Well</text>
          </view>
          <view class="hint-item">• Particle behavior and properties</view>
          <view class="hint-item">• Basic wave mechanics</view>
          <view class="hint-item">• Historical context of quantum theory</view>
        </view>

        <view class="hint-card warn">
          <view class="hint-title">
            <t-icon name="star" size="32rpx" color="#f97316" />
            <text>Areas to Improve</text>
          </view>
          <view class="hint-item">• Mathematical formulation of wave functions</view>
          <view class="hint-item">• Double-slit experiment specifics</view>
          <view class="hint-item">• Implications for measurement and observation</view>
        </view>

        <view class="hint-card info">
          <view class="hint-info-title">Generated 5 new cards focused on your weak points</view>
          <view class="hint-info-sub">These cards are now added to your deck for focused practice.</view>
        </view>

        <button class="lc-btn lc-btn-primary full-btn" bind:tap="onRestart">Start New Session</button>
      </view>
    </view>
  </view>
</view>


