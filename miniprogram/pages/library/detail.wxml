<view
  class="lc-root {{theme === 'dark' ? 'lc-theme-dark' : ''}}"
  style="--lc-status-bar: {{statusBarRpx}}rpx; --lc-safe-bottom: {{safeBottomRpx}}rpx; --lc-tabbar-h: 0rpx;"
>
  <view class="lc-header">
    <view class="lc-header-inner">
      <text class="lc-header-title">LearnCards</text>
    </view>
  </view>

  <view class="lc-main">
    <view class="lc-container deck-container">
      <!-- Back -->
      <view class="back-btn" bind:tap="onBack" hover-class="lc-hover-bg">
        <t-icon name="chevron-left" size="36rpx" color="var(--lc-text-muted)" />
        <text class="back-text">Back</text>
  </view>

      <!-- Deck Header Card -->
      <view class="deck-header-card">
        <view class="deck-header-top">
          <view class="deck-header-main">
            <view class="deck-header-title">{{deck.title}}</view>
            <view class="deck-tags">
              <text
                wx:for="{{deck.tags}}"
                wx:for-item="tag"
                wx:key="*this"
                class="deck-tag"
              >
              {{tag}}
              </text>
            </view>
          </view>
          <view class="deck-actions">
            <button class="study-btn" bind:tap="onStartStudy" hover-class="lc-hover-primary">
              <t-icon name="play" size="28rpx" color="#fff" />
              <text class="study-text">Study</text>
            </button>
            <button class="review-btn" bind:tap="onStartReview" hover-class="lc-hover-bg">
              <t-icon name="time" size="28rpx" color="var(--lc-primary)" />
              <text class="review-text">Review {{deck.dueCount}}</text>
            </button>
          </view>
        </view>

        <view class="deck-progress">
          <view class="deck-progress-row">
            <text class="deck-sub">{{deckCards.length}} cards â€¢ {{deck.dueCount}} due</text>
            <text class="deck-progress-value">{{deck.progress}}%</text>
          </view>
          <view class="lc-progress-track">
            <view class="lc-progress-bar" style="width: {{deck.progress}}%;" />
            </view>
          </view>
        </view>

      <!-- Cards List -->
      <view class="cards-section">
        <view class="lc-section-title">Cards ({{deckCards.length}})</view>

        <view wx:if="{{isLoadingDeck && !deckCards.length}}" class="lc-card empty-card">
          <view class="lc-inline-loading" style="padding: 48rpx 0;">
            <view class="lc-mini-spinner" />
            <text class="lc-p">Loading cards...</text>
          </view>
        </view>

        <view wx:elif="{{!deckCards.length}}" class="lc-card empty-card">
          <view class="lc-p" style="text-align:center; margin-bottom: 24rpx;">
            No cards yet. Add your first card to get started!
          </view>
          <button class="lc-btn lc-btn-primary" bind:tap="onOpenAddModal" hover-class="lc-hover-primary">
            <t-icon name="add" size="36rpx" color="#fff" />
            <text style="margin-left: 12rpx;">Add First Card</text>
          </button>
        </view>

        <view wx:else class="cards-list">
          <block wx:for="{{deckCards}}" wx:key="id">
            <view class="card-item" hover-class="lc-hover-border">
              <view class="card-content">
                <view class="card-label">Question</view>
                <view class="card-q">{{item.question}}</view>
                <view class="card-label" style="margin-top: 16rpx;">Answer</view>
                <view class="card-a">{{item.answer}}</view>
              </view>
              <view class="card-actions">
                <button class="icon-btn" catch:tap="onEditCard" data-id="{{item.id}}" hover-class="lc-hover-bg">
                  <t-icon name="edit-1" size="28rpx" color="var(--lc-text-muted)" />
                </button>
                <button class="icon-btn danger" disabled="{{deletingId === item.id}}" catch:tap="onDeleteCard" data-id="{{item.id}}" hover-class="lc-hover-danger-bg">
                  <t-icon name="delete" size="28rpx" color="var(--lc-danger)" />
                </button>
        </view>
      </view>
    </block>
        </view>
      </view>
    </view>
  </view>

  <!-- Floating Add Button -->
  <button wx:if="{{deckCards.length > 0}}" class="fab" bind:tap="onOpenAddModal" hover-class="lc-hover-primary">
    <t-icon name="add" size="44rpx" color="#fff" />
  </button>

  <!-- Add / Edit Card Modal -->
  <view wx:if="{{modalVisible}}" class="lc-modal-overlay" catch:tap="onCloseModal">
    <view class="lc-modal modal-max" catch:tap="noop">
      <view class="lc-modal-header">
        <text class="lc-modal-title">{{editingCardId ? 'Edit Card' : 'Add New Card'}}</text>
        <button class="lc-icon-btn" catch:tap="onCloseModal" hover-class="lc-hover-bg">
          <t-icon name="close" size="40rpx" color="var(--lc-text-muted)" />
        </button>
      </view>

      <!-- Mode Tabs -->
      <view wx:if="{{!editingCardId}}" class="mode-tabs">
        <view class="tab {{modalMode === 'manual' ? 'is-active' : ''}}" data-mode="manual" catch:tap="onChangeModalMode">
          <t-icon name="edit-1" size="28rpx" color="{{modalMode === 'manual' ? '#fff' : 'var(--lc-text-muted)'}}" />
          <text>Manual</text>
        </view>
        <view class="tab {{modalMode === 'scan' ? 'is-active' : ''}}" data-mode="scan" catch:tap="onChangeModalMode">
          <t-icon name="scan" size="28rpx" color="{{modalMode === 'scan' ? '#fff' : 'var(--lc-text-muted)'}}" />
          <text>Scan</text>
        </view>
        <view class="tab {{modalMode === 'upload' ? 'is-active' : ''}}" data-mode="upload" catch:tap="onChangeModalMode">
          <t-icon name="upload" size="28rpx" color="{{modalMode === 'upload' ? '#fff' : 'var(--lc-text-muted)'}}" />
          <text>Upload</text>
            </view>
        <view class="tab {{modalMode === 'paste' ? 'is-active' : ''}}" data-mode="paste" catch:tap="onChangeModalMode">
          <t-icon name="file-paste" size="28rpx" color="{{modalMode === 'paste' ? '#fff' : 'var(--lc-text-muted)'}}" />
          <text>Paste</text>
            </view>
          </view>

      <scroll-view scroll-y class="modal-scroll">
        <view class="lc-modal-body">
          <block wx:if="{{modalMode === 'manual' || modalMode === 'paste'}}">
            <view class="field-label">Question</view>
            <textarea
              class="lc-input textarea"
              value="{{modalQuestion}}"
              placeholder="Enter the question here..."
              placeholder-class="home-placeholder"
              bindinput="onModalQuestionInput"
            />

            <view class="field-label" style="margin-top: 24rpx;">Answer</view>
            <textarea
              class="lc-input textarea"
              value="{{modalAnswer}}"
              placeholder="Enter the answer here..."
              placeholder-class="home-placeholder"
              bindinput="onModalAnswerInput"
            />
        </block>

          <view wx:elif="{{modalMode === 'scan'}}" class="coming-box">
            <t-icon name="scan" size="96rpx" color="var(--lc-text-subtle)" />
            <view class="coming-text">Scan a photo of your notes or textbook</view>
            <button class="lc-btn lc-btn-primary" style="margin-top: 24rpx;">Open Camera</button>
            <view class="coming-sub">Coming soon: AI-powered text extraction from images</view>
        </view>

          <view wx:elif="{{modalMode === 'upload'}}" class="coming-box">
            <t-icon name="upload" size="96rpx" color="var(--lc-text-subtle)" />
            <view class="coming-text">Upload a file to extract cards</view>
            <button class="lc-btn lc-btn-primary" style="margin-top: 24rpx;">Choose File</button>
            <view class="coming-sub">Supported: PDF, DOCX, TXT</view>
          </view>
        </view>
      </scroll-view>

      <view wx:if="{{modalMode === 'manual' || modalMode === 'paste'}}" class="lc-modal-footer">
        <button class="lc-btn footer-btn-cancel" disabled="{{isSaving}}" catch:tap="onCloseModal">Cancel</button>
        <button wx:if="{{!editingCardId}}" class="lc-btn lc-btn-primary" disabled="{{isSaving}}" catch:tap="onSaveAndAdd">
          Save & Add Another
        </button>
        <button class="lc-btn lc-btn-primary" disabled="{{isSaving}}" catch:tap="onSaveClose">
          <block wx:if="{{isSaving}}">Saving...</block>
          <block wx:else>{{editingCardId ? 'Save Changes' : 'Save & Close'}}</block>
        </button>
      </view>
    </view>
    </view>
</view>
